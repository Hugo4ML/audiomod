<!DOCTYPE html>
<html>
  <head>
    <title>Loop audio file(9)</title>
  </head>
  <body>
    <input type = "file" id = "file"></input>
    <button onclick='window.document.getElementById("header1").innerHTML = "loopAudio call state";'>Reset header</button>
    <button onclick='loopAudio();'>Concat audio!</button>
    <h1 id = 'header1'>Header</h1>
    <h2 id = 'header2'>Header</h2>
    <script>
      window.document.getElementById("header1").innerHTML = "loopAudio call state"
      async function loopAudio() {
        /*
        Generates new audio by concatenating original to itself until it passes the specified lenght in time.
        */
        window.document.getElementById("header1").innerHTML = "loopAudio called"; //Confirms function call.
        const file = window.document.getElementById("file").files[0], name = file.name, type = name.substring(name.lastIndexOf('.') + 1, filename.length) || filename;
        const fileReader = new FileReader();
        fileReader.onload = event => {
          /*
          Generate new blob with repeated audio data.
          */
          
          window.document.getElementById("header1").innerHTML = "Close"; //Confirms function call.
          //const audioContext = new AudioContext();
          
          window.document.getElementById("header1").innerHTML = "Not even"; //Confirms function call.
          /*audioContext.decodeAudioData(event.target.result, data => {
            const array = new Array((12.5 * 3600 / data.duration) - (12.5 * 3600 / data.duration % 1));
            for(let index = 0; index < array.length; ++index) array[index] = data;
            const blob = new Blob(array), url = URL.createObjectURL(blob), audio = new Audio(url);
            window.document.getElementById("header1").innerHTML = "End not reached." + array.length;
            
            let link = document.createElement("Link");
            
            link.href = url;
            link.download = "DOWNLOAD.m4a";
            link.click();
            
            window.document.getElementById("header1").innerHTML = "End kinda reached." + array.length;
          });*/
          const blob = new Blob([event.target.result], {type: "audio/" + type}), url = URL.createObjectURL(blob);/*, audio = new Audio(url);
          window.document.getElementById("header1").innerHTML = "End not reached.";*/
          
          let link = document.createElement("Link");
          
          link.href = url;
          link.download = "DOWNLOAD." + type;
          link.click();
            
          window.document.getElementById("header1").innerHTML = "End reached.";
        };
        fileReader.readAsArrayBuffer(file);
      }
    </script>
  </body>
</html>
